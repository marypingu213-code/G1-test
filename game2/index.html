<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çœ‹åœ–å¥å­é‡çµ„</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@500;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: "Zen Maru Gothic", "å¾®è»Ÿæ­£é»‘é«”", sans-serif;
            background-color: #fce4ec;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            margin: 0;
            min-height: 100vh;
        }

        h1 { color: #880e4f; margin-bottom: 10px; }

        #progress {
            margin-bottom: 15px;
            font-size: 1.2rem;
            color: #555;
            font-weight: bold;
        }

        .image-container {
            background: white;
            padding: 10px;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            margin-bottom: 10px;
            max-width: 90%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #question-image {
            max-width: 100%;
            max-height: 300px;
            border-radius: 10px;
            display: block;
            min-height: 150px; 
            min-width: 200px;
            background-color: #eee;
        }

        /* ğŸ”Š æœ—è®€æŒ‰éˆ•æ¨£å¼ */
        .speak-btn {
            background-color: #FF9800;
            color: white;
            border: none;
            border-radius: 50px;
            padding: 8px 20px;
            margin-top: 10px;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            font-family: "Zen Maru Gothic", sans-serif;
            transition: transform 0.1s;
        }
        
        .speak-btn:active { transform: scale(0.95); }
        .speak-btn:hover { background-color: #f57c00; }

        #answer-area {
            width: 90%;
            max-width: 800px;
            min-height: 80px;
            background-color: #e3f2fd;
            border: 2px dashed #2196F3;
            border-radius: 10px;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
            padding: 15px;
            margin-bottom: 20px;
            gap: 10px;
        }

        #options-area {
            width: 90%;
            max-width: 800px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
        }

        .word-card {
            background-color: white;
            border: 2px solid #ff4081;
            color: #333;
            padding: 10px 20px;
            border-radius: 50px;
            font-size: 1.5rem;
            cursor: grab;
            user-select: none;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .word-card.dragging {
            opacity: 0.5;
            cursor: grabbing;
            background-color: #ccc;
        }

        .controls {
            display: flex;
            gap: 15px;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }

        button {
            padding: 12px 40px;
            font-size: 1.3rem;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 4px 0 rgba(0,0,0,0.2);
            font-family: "Zen Maru Gothic", sans-serif;
        }

        #check-btn { background-color: #4CAF50; color: white; }
        #next-btn { background-color: #2196F3; color: white; display: none; }
        
        .final-btns {
            display: none;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .btn-lobby { background-color: #795548; color: white; }
        .btn-game2 { background-color: #9c27b0; color: white; }

        #message {
            font-size: 1.5rem;
            height: 30px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 10px;
        }
        .correct-msg { color: green; }
        .wrong-msg { color: red; }

    </style>
</head>
<body>

    <h1>çœ‹åœ–é‡çµ„å¥å­</h1>
    <div id="progress">æº–å‚™é–‹å§‹...</div>

    <div class="image-container">
        <img id="question-image" src="" alt="é¡Œç›®åœ–ç‰‡">
        <button class="speak-btn" onclick="readSentence()">
            ğŸ”Š å”¸çµ¦æˆ‘è½
        </button>
    </div>

    <div id="answer-area" class="drop-zone"></div>
    <div id="options-area" class="drop-zone"></div>

    <div id="message"></div>

    <div class="controls">
        <button id="check-btn" onclick="checkAnswer()">æª¢æŸ¥ç­”æ¡ˆ</button>
        <button id="next-btn" onclick="nextQuestion()">ä¸‹ä¸€é¡Œ â”</button>

        <div id="final-buttons" class="final-btns">
            <button class="btn-lobby" onclick="goToLobby()">ğŸ  å›åˆ°å¤§å»³</button>
            <button class="btn-game2" onclick="goToGame2()">ğŸ® å‰å¾€ä¸‹ä¸€é—œ</button>
        </div>
    </div>

    <script>
        // è¨­å®šå€
        const questions = [
            { img: '1.png', text: 'æ³¡æ³¡ å¥½åƒ åœ¨ æŠ±æŠ±' },
            { img: '2.png', text: 'æˆ¿å­è£¡ æœ‰ æ»¿æ»¿çš„ å¹¸ç¦' },
            { img: '3.png', text: 'æˆ‘ æŠŠ ç´…ç´…çš„ æ»¿ è²¼åœ¨ å®¶è£¡' },
            { img: '4.png', text: 'é­šç¼¸è£¡ éƒ½æ˜¯ æ‚„æ‚„è©±' },
            { img: '5.png', text: 'é­šç¼¸è£¡ é–‹æ»¿ å¤§ ç´…èŠ±' },
            { img: '6.png', text: 'æˆ‘å€‘ ä½çš„ æ˜¯ åœ°çƒ' },
            { img: '7.png', text: 'å¤–æ˜Ÿäºº ä½  ä½åœ¨ å“ªå€‹ æ˜Ÿçƒ?' },
            { img: '8.png', text: 'æˆ‘ è¦ å’Œ ä»– åš æœ‹å‹' },
            { img: '9.png', text: 'åœ¨ é’é’çš„ å±±ä¸Š' },
            { img: '10.png', text: 'æˆ‘ å¤§å« ï¼š ä½ å¥½' }
        ];
        
        const folderPath = ''; 
        let currentQIndex = 0;
        let currentWords = [];
        
        const imgEl = document.getElementById('question-image');
        const answerArea = document.getElementById('answer-area');
        const optionsArea = document.getElementById('options-area');
        const msgEl = document.getElementById('message');
        const nextBtn = document.getElementById('next-btn');
        const checkBtn = document.getElementById('check-btn');
        const progressEl = document.getElementById('progress');
        const finalBtnsDiv = document.getElementById('final-buttons');

        // å•Ÿå‹•éŠæˆ²
        loadQuestion(currentQIndex);

        function loadQuestion(index) {
            answerArea.innerHTML = '';
            optionsArea.innerHTML = '';
            msgEl.textContent = '';
            msgEl.className = '';
            nextBtn.style.display = 'none';
            checkBtn.style.display = 'block';
            checkBtn.disabled = false;
            
            if (index >= questions.length) {
                gameFinished();
                return;
            }

            const q = questions[index];
            imgEl.src = folderPath + q.img;
            imgEl.style.display = 'block';
            progressEl.textContent = `ç¬¬ ${index + 1} é¡Œ / å…± ${questions.length} é¡Œ`;

            currentWords = q.text.split(' ').filter(Boolean); 

            let shuffledWords = [...currentWords];
            shuffleArray(shuffledWords);

            shuffledWords.forEach(word => {
                const card = createWordCard(word);
                optionsArea.appendChild(card);
            });
        }

        // ğŸ”Š èªéŸ³åŠŸèƒ½
        function readSentence() {
            let textToRead = questions[currentQIndex].text.replace(/\s/g, '');
            let utterance = new SpeechSynthesisUtterance(textToRead);
            utterance.lang = 'zh-TW'; 
            utterance.rate = 0.8; 
            window.speechSynthesis.cancel(); 
            window.speechSynthesis.speak(utterance);
        }

        function gameFinished() {
            imgEl.style.display = 'none';
            document.querySelector('.speak-btn').style.display = 'none';
            answerArea.style.display = 'none';
            optionsArea.style.display = 'none';
            progressEl.innerHTML = "ğŸ‰ <br>æ­å–œï¼å…¨éƒ¨é¡Œç›®éƒ½å®Œæˆäº†ï¼";
            progressEl.style.color = "#d81b60";
            checkBtn.style.display = 'none';
            nextBtn.style.display = 'none';
            finalBtnsDiv.style.display = 'flex';
        }

        function goToLobby() { window.location.href = '../index.html'; }
        function goToGame2() { window.location.href = '../game2/index.html'; }

        function createWordCard(text) {
            const div = document.createElement('div');
            div.className = 'word-card';
            div.textContent = text;
            div.draggable = true;
            div.addEventListener('dragstart', () => div.classList.add('dragging'));
            div.addEventListener('dragend', () => div.classList.remove('dragging'));
            div.addEventListener('click', () => {
                if (div.parentElement === optionsArea) { answerArea.appendChild(div); } 
                else { optionsArea.appendChild(div); }
            });
            return div;
        }

        function checkAnswer() {
            const answerCards = answerArea.querySelectorAll('.word-card');
            const studentAnswer = Array.from(answerCards).map(card => card.textContent).join('');
            const correctAnswer = currentWords.join('');
            if (studentAnswer === correctAnswer) {
                msgEl.textContent = 'ğŸ‰ ç­”å°äº†ï¼ä½ å¥½æ£’ï¼';
                msgEl.className = 'correct-msg';
                checkBtn.style.display = 'none';
                nextBtn.style.display = 'block'; 
                answerCards.forEach(c => c.draggable = false);
            } else {
                msgEl.textContent = 'âŒ å†è©¦è©¦çœ‹ï¼Œé †åºå¥½åƒä¸å°å–”ï¼';
                msgEl.className = 'wrong-msg';
            }
        }

        function nextQuestion() {
            currentQIndex++;
            loadQuestion(currentQIndex);
        }

        const dropZones = [answerArea, optionsArea];
        dropZones.forEach(zone => {
            zone.addEventListener('dragover', e => {
                e.preventDefault();
                const afterElement = getDragAfterElement(zone, e.clientX, e.clientY);
                const draggable = document.querySelector('.dragging');
                if (afterElement == null) { zone.appendChild(draggable); } 
                else { zone.insertBefore(draggable, afterElement); }
            });
        });

        function getDragAfterElement(container, x, y) {
            const draggableElements = [...container.querySelectorAll('.word-card:not(.dragging)')];
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offsetX = x - box.left - box.width / 2;
                if (offsetX < 0 && offsetX > closest.offset) { return { offset: offsetX, element: child }; } 
                else { return closest; }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }
    </script>
</body>
</html>
